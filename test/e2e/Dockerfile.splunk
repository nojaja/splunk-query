FROM splunk/splunk:8.2.0

# Copy init script to insert deterministic sample event on startup
# Copy init script; executable bit will be ensured at container runtime
COPY container/init-index.sh /opt/splunk/bin/init-index.sh

# Copy entrypoint wrapper and use it as the image ENTRYPOINT so we can
# perform runtime permission fixes before starting the base entrypoint.
COPY container/entrypoint-wrapper.sh /opt/splunk/bin/entrypoint-wrapper.sh

# Create necessary directories for E2E operations
RUN mkdir -p /tmp/logs || true

# Run the wrapper via bash so we don't depend on executable bit at image-build time
ENTRYPOINT ["/bin/bash", "/opt/splunk/bin/entrypoint-wrapper.sh"]
